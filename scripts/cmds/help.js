const { commands, aliases } = global.GoatBot;

// --- Fonction pour transformer un texte en style ğ‘¨ğ’ ---
function toAZStyle(text) {
  const azMap = {
    A:'ğ‘¨', B:'ğ‘©', C:'ğ‘ª', D:'ğ‘«', E:'ğ‘¬', F:'ğ‘­', G:'ğ‘®', H:'ğ‘¯', I:'ğ‘°', J:'ğ‘±',
    K:'ğ‘²', L:'ğ‘³', M:'ğ‘´', N:'ğ‘µ', O:'ğ‘¶', P:'ğ‘·', Q:'ğ‘¸', R:'ğ‘¹', S:'ğ‘º', T:'ğ‘»',
    U:'ğ‘¼', V:'ğ‘½', W:'ğ‘¾', X:'ğ‘¿', Y:'ğ’€', Z:'ğ’',
    a:'ğ’‚', b:'ğ’ƒ', c:'ğ’„', d:'ğ’…', e:'ğ’†', f:'ğ’‡', g:'ğ’ˆ', h:'ğ’‰', i:'ğ’Š', j:'ğ’‹',
    k:'ğ’Œ', l:'ğ’', m:'ğ’', n:'ğ’', o:'ğ’', p:'ğ’‘', q:'ğ’’', r:'ğ’“', s:'ğ’”', t:'ğ’•',
    u:'ğ’–', v:'ğ’—', w:'ğ’˜', x:'ğ’™', y:'ğ’š', z:'ğ’›',
    '0':'0','1':'1','2':'2','3':'3','4':'4','5':'5','6':'6','7':'7','8':'8','9':'9',
    ' ':' '
  };
  return text.split('').map(c => azMap[c] || c).join('');
}

module.exports = {
  config: {
    name: "help",
    version: "6.0",
    author: "ğŸ’® TRÃ˜N ARÃ‹S BÃ˜T ğŸ’®",
    countDown: 2,
    role: 0,
    shortDescription: { en: "ğ¸ğ‘¥ğ‘ğ‘™ğ‘œğ‘Ÿğ‘’ ğ‘‡ğ‘…Ã˜ğ‘ ğ´ğ‘…Ã‹ğ‘† ğ‘ğ‘¦ğ‘ğ‘’ğ‘Ÿğ‘›ğ‘’ğ‘¡ğ‘–ğ‘ ğ‘ğ‘œğ‘šğ‘šğ‘ğ‘›ğ‘‘ğ‘ " },
    category: "âš¡ system",
    guide: { en: "help <command> â€” ğ‘”ğ‘’ğ‘¡ ğ‘ğ‘œğ‘šğ‘šğ‘ğ‘›ğ‘‘ ğ‘–ğ‘›ğ‘“ğ‘œ, -ai ğ‘“ğ‘œğ‘Ÿ ğ‘›ğ‘’ğ‘¢ğ‘Ÿğ‘ğ‘™ ğ‘ ğ‘¢ğ‘”ğ‘”ğ‘’ğ‘ ğ‘¡ğ‘–ğ‘œğ‘›ğ‘ " },
  },

  onStart: async function ({ message, args, event, usersData }) {
    try {
      const uid = event.senderID;
      let avatar = await usersData.getAvatarUrl(uid).catch(() => null);
      if (!avatar) avatar = "https://i.imgur.com/TPHk4Qu.png";

      const autoDelete = async (msgID, delay = 15000) => {
        const countdown = [10,5,3,2,1];
        countdown.forEach((s) => {
          setTimeout(() => {
            message.edit(msgID, `â³ ğ¶ğ‘¦ğ‘ğ‘’ğ‘Ÿğ‘›ğ‘’ğ‘¡ğ‘–ğ‘ ğ‘ ğ‘¢ğ‘ğ‘ğ‘Ÿğ‘’ğ‘ ğ‘ ğ‘–ğ‘œğ‘› ğ‘‘ğ‘ğ‘›ğ‘  ${s}ğ‘ ...`);
          }, delay - s*1000);
        });
        setTimeout(async () => {
          try { await message.unsend(msgID); } 
          catch (err) { console.error("âŒ ğ»ğ‘’ğ‘™ğ‘ ğ‘‘ğ‘’ğ‘™ğ‘’ğ‘¡ğ‘’ ğ‘’ğ‘Ÿğ‘Ÿğ‘œğ‘Ÿ:", err.message); }
        }, delay);
      };

      // --- AI Suggestion ---
      if(args[0]?.toLowerCase() === "-ai") {
        const keyword = args[1]?.toLowerCase() || "";
        const allCmds = Array.from(commands.keys());
        const suggestions = allCmds
          .map(cmd => ({ cmd, match: Math.max(40, 100 - Math.abs(cmd.length - keyword.length) * 10) }))
          .filter(c => c.cmd.includes(keyword))
          .sort((a,b)=>b.match - a.match)
          .slice(0,10);

        if(!suggestions.length) {
          const res = await message.reply({ 
            body: "ğŸ“¢ ğ‘ğ‘œğ‘¡ğ‘–ğ‘“ğ‘–ğ‘ğ‘ğ‘¡ğ‘–ğ‘œğ‘› ğ‘“ğ‘Ÿğ‘œğ‘š ğ‘ğ‘‘ğ‘šğ‘–ğ‘› ğ‘ğ‘œğ‘¡ ğ‘¡ğ‘œ ğ‘ğ‘™ğ‘™ ğ‘â„ğ‘ğ‘¡ ğ‘”ğ‘Ÿğ‘œğ‘¢ğ‘ğ‘  (ğ‘‘ğ‘œ ğ‘›ğ‘œğ‘¡ ğ‘Ÿğ‘’ğ‘ğ‘™ğ‘¦ ğ‘¡ğ‘œ ğ‘¡â„ğ‘–ğ‘  ğ‘šğ‘’ğ‘ ğ‘ ğ‘ğ‘”ğ‘’)\n" +
                  "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n" +
                  "â”Œâ”€â”â”â”â”â”â•â”â•â”â”â”â”â”â”€â”\n" +
                  "   âš¡ ğ‘ğ¸ğ‘ˆğ‘…ğ´ğ¿ ğ‘†ğ‘ˆğºğºğ¸ğ‘†ğ‘‡ğ¼ğ‘‚ğ‘ğ‘† âš¡\n" +
                  "â””â”€â”â”â”â”â”â•â”â•â”â”â”â”â”â”€â”˜\n\n" +
                  "â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬\n" +
                  "   âŒ ğ´ğ‘ğ´ğ¿ğ‘Œğ‘†ğ¼ğ‘† ğ‘…ğ¸ğ‘†ğ‘ˆğ¿ğ‘‡ğ‘†\n" +
                  "â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬\n" +
                  "â”‚ ğ‘ğ‘œ ğ‘ğ‘œğ‘šğ‘šğ‘ğ‘›ğ‘‘ğ‘  ğ‘šğ‘ğ‘¡ğ‘â„ğ‘–ğ‘›ğ‘”: '" + keyword + "'\n" +
                  "â”‚ ğ‘‡ğ‘Ÿğ‘¦ ğ‘‘ğ‘–ğ‘“ğ‘“ğ‘’ğ‘Ÿğ‘’ğ‘›ğ‘¡ ğ‘˜ğ‘’ğ‘¦ğ‘¤ğ‘œğ‘Ÿğ‘‘ğ‘ \n" +
                  "â•°â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”",
            attachment: await global.utils.getStreamFromURL(avatar)
          });
          return autoDelete(res.messageID);
        }

        const body = "ğŸ“¢ ğ‘ğ‘œğ‘¡ğ‘–ğ‘“ğ‘–ğ‘ğ‘ğ‘¡ğ‘–ğ‘œğ‘› ğ‘“ğ‘Ÿğ‘œğ‘š ğ‘ğ‘‘ğ‘šğ‘–ğ‘› ğ‘ğ‘œğ‘¡ ğ‘¡ğ‘œ ğ‘ğ‘™ğ‘™ ğ‘â„ğ‘ğ‘¡ ğ‘”ğ‘Ÿğ‘œğ‘¢ğ‘ğ‘  (ğ‘‘ğ‘œ ğ‘›ğ‘œğ‘¡ ğ‘Ÿğ‘’ğ‘ğ‘™ğ‘¦ ğ‘¡ğ‘œ ğ‘¡â„ğ‘–ğ‘  ğ‘šğ‘’ğ‘ ğ‘ ğ‘ğ‘”ğ‘’)\n" +
                    "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n" +
                    "â”Œâ”€â”â”â”â”â”â•â”â•â”â”â”â”â”â”€â”\n" +
                    "   âš¡ ğ‘ğ¸ğ‘ˆğ‘…ğ´ğ¿ ğ‘†ğ‘ˆğºğºğ¸ğ‘†ğ‘‡ğ¼ğ‘‚ğ‘ğ‘† âš¡\n" +
                    "â””â”€â”â”â”â”â”â•â”â•â”â”â”â”â”â”€â”˜\n\n" +
                    "â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬\n" +
                    "   ğŸ§  ğ´ğ¼ ğ‘ƒğ‘…ğ‘‚ğ‘‡ğ‘‚ğ¶ğ‘‚ğ¿ğ‘†\n" +
                    "â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬\n\n" +
                    suggestions.map(s=>`â—ˆ ${toAZStyle(s.cmd)} (${s.match}% ğ‘šğ‘ğ‘¡ğ‘â„)`).join("\n") + "\n\n" +
                    "â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬\n" +
                    "   ğŸ“Š ğ´ğ‘ğ´ğ¿ğ‘Œğ‘†ğ¼ğ‘† ğ¶ğ‘‚ğ‘€ğ‘ƒğ¿ğ¸ğ‘‡ğ¸\n" +
                    "â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬\n" +
                    "â”‚ " + suggestions.length + " ğ‘Ÿğ‘’ğ‘ ğ‘¢ğ‘™ğ‘¡ğ‘  ğ‘“ğ‘œğ‘¢ğ‘›ğ‘‘\n" +
                    "â”‚ ğ¾ğ‘’ğ‘¦ğ‘¤ğ‘œğ‘Ÿğ‘‘: '" + keyword + "'\n" +
                    "â•°â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”";

        const res = await message.reply({ body, attachment: await global.utils.getStreamFromURL(avatar) });
        return autoDelete(res.messageID);
      }

      // --- Search Feature ---
      if(args[0]?.toLowerCase() === "-s") {
        const keyword = args.slice(1).join(" ").toLowerCase();
        if (!keyword) {
          const body = "ğŸ“¢ ğ‘ğ‘œğ‘¡ğ‘–ğ‘“ğ‘–ğ‘ğ‘ğ‘¡ğ‘–ğ‘œğ‘› ğ‘“ğ‘Ÿğ‘œğ‘š ğ‘ğ‘‘ğ‘šğ‘–ğ‘› ğ‘ğ‘œğ‘¡ ğ‘¡ğ‘œ ğ‘ğ‘™ğ‘™ ğ‘â„ğ‘ğ‘¡ ğ‘”ğ‘Ÿğ‘œğ‘¢ğ‘ğ‘  (ğ‘‘ğ‘œ ğ‘›ğ‘œğ‘¡ ğ‘Ÿğ‘’ğ‘ğ‘™ğ‘¦ ğ‘¡ğ‘œ ğ‘¡â„ğ‘–ğ‘  ğ‘šğ‘’ğ‘ ğ‘ ğ‘ğ‘”ğ‘’)\n" +
                      "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n" +
                      "â”Œâ”€â”â”â”â”â”â•â”â•â”â”â”â”â”â”€â”\n" +
                      "   âš¡ ğ¶ğ‘Œğµğ¸ğ‘… ğ‘†ğ¸ğ´ğ‘…ğ¶ğ» âš¡\n" +
                      "â””â”€â”â”â”â”â”â•â”â•â”â”â”â”â”â”€â”˜\n\n" +
                      "â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬\n" +
                      "   âŒ ğ¼ğ‘ğ‘ƒğ‘ˆğ‘‡ ğ¸ğ‘…ğ‘…ğ‘‚ğ‘…\n" +
                      "â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬\n" +
                      "â”‚ ğ‘ƒğ‘™ğ‘’ğ‘ğ‘ ğ‘’ ğ‘ğ‘Ÿğ‘œğ‘£ğ‘–ğ‘‘ğ‘’ ğ‘ ğ‘ ğ‘’ğ‘ğ‘Ÿğ‘â„ ğ‘˜ğ‘’ğ‘¦ğ‘¤ğ‘œğ‘Ÿğ‘‘\n" +
                      "â”‚ ğ‘ˆğ‘ ğ‘ğ‘”ğ‘’: .help -s <keyword>\n" +
                      "â•°â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”";
          
          const res = await message.reply({ body, attachment: await global.utils.getStreamFromURL(avatar) });
          return autoDelete(res.messageID);
        }

        const results = Array.from(commands.keys())
          .filter(cmd => cmd.toLowerCase().includes(keyword))
          .sort()
          .slice(0, 15);

        if (!results.length) {
          const body = "ğŸ“¢ ğ‘ğ‘œğ‘¡ğ‘–ğ‘“ğ‘–ğ‘ğ‘ğ‘¡ğ‘–ğ‘œğ‘› ğ‘“ğ‘Ÿğ‘œğ‘š ğ‘ğ‘‘ğ‘šğ‘–ğ‘› ğ‘ğ‘œğ‘¡ ğ‘¡ğ‘œ ğ‘ğ‘™ğ‘™ ğ‘â„ğ‘ğ‘¡ ğ‘”ğ‘Ÿğ‘œğ‘¢ğ‘ğ‘  (ğ‘‘ğ‘œ ğ‘›ğ‘œğ‘¡ ğ‘Ÿğ‘’ğ‘ğ‘™ğ‘¦ ğ‘¡ğ‘œ ğ‘¡â„ğ‘–ğ‘  ğ‘šğ‘’ğ‘ ğ‘ ğ‘ğ‘”ğ‘’)\n" +
                      "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n" +
                      "â”Œâ”€â”â”â”â”â”â•â”â•â”â”â”â”â”â”€â”\n" +
                      "   âš¡ ğ¶ğ‘Œğµğ¸ğ‘… ğ‘†ğ¸ğ´ğ‘…ğ¶ğ» âš¡\n" +
                      "â””â”€â”â”â”â”â”â•â”â•â”â”â”â”â”â”€â”˜\n\n" +
                      "â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬\n" +
                      "   âŒ ğ‘ğ‘‚ ğ‘…ğ¸ğ‘†ğ‘ˆğ¿ğ‘‡ğ‘†\n" +
                      "â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬\n" +
                      "â”‚ ğ‘ğ‘œ ğ‘ğ‘œğ‘šğ‘šğ‘ğ‘›ğ‘‘ğ‘  ğ‘“ğ‘œğ‘¢ğ‘›ğ‘‘ ğ‘“ğ‘œğ‘Ÿ: '" + keyword + "'\n" +
                      "â•°â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”";
          
          const res = await message.reply({ body, attachment: await global.utils.getStreamFromURL(avatar) });
          return autoDelete(res.messageID);
        }

        const body = "ğŸ“¢ ğ‘ğ‘œğ‘¡ğ‘–ğ‘“ğ‘–ğ‘ğ‘ğ‘¡ğ‘–ğ‘œğ‘› ğ‘“ğ‘Ÿğ‘œğ‘š ğ‘ğ‘‘ğ‘šğ‘–ğ‘› ğ‘ğ‘œğ‘¡ ğ‘¡ğ‘œ ğ‘ğ‘™ğ‘™ ğ‘â„ğ‘ğ‘¡ ğ‘”ğ‘Ÿğ‘œğ‘¢ğ‘ğ‘  (ğ‘‘ğ‘œ ğ‘›ğ‘œğ‘¡ ğ‘Ÿğ‘’ğ‘ğ‘™ğ‘¦ ğ‘¡ğ‘œ ğ‘¡â„ğ‘–ğ‘  ğ‘šğ‘’ğ‘ ğ‘ ğ‘ğ‘”ğ‘’)\n" +
                    "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n" +
                    "â”Œâ”€â”â”â”â”â”â•â”â•â”â”â”â”â”â”€â”\n" +
                    "   âš¡ ğ¶ğ‘Œğµğ¸ğ‘… ğ‘†ğ¸ğ´ğ‘…ğ¶ğ» âš¡\n" +
                    "â””â”€â”â”â”â”â”â•â”â•â”â”â”â”â”â”€â”˜\n\n" +
                    "â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬\n" +
                    "   ğŸ” ğ‘…ğ¸ğ‘†ğ‘ˆğ¿ğ‘‡ğ‘† ğ¹ğ‘‚ğ‘…: \"" + keyword + "\"\n" +
                    "â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬\n\n" +
                    results.map(cmd => `â—ˆ ${toAZStyle(cmd)}`).join("\n") + "\n\n" +
                    "â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬\n" +
                    "   ğŸ“Š ğ‘†ğ¸ğ´ğ‘…ğ¶ğ» ğ‘†ğ‘‡ğ´ğ‘‡ğ‘†\n" +
                    "â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬\n" +
                    "â”‚ " + results.length + " ğ‘ğ‘œğ‘šğ‘šğ‘ğ‘›ğ‘‘ğ‘  ğ‘“ğ‘œğ‘¢ğ‘›ğ‘‘\n" +
                    "â•°â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”";

        const res = await message.reply({ body, attachment: await global.utils.getStreamFromURL(avatar) });
        return autoDelete(res.messageID);
      }

      // --- Command List ---
      if(!args || args.length === 0) {
        const notificationHeader = "ğŸ“¢ ğ‘ğ‘œğ‘¡ğ‘–ğ‘“ğ‘–ğ‘ğ‘ğ‘¡ğ‘–ğ‘œğ‘› ğ‘“ğ‘Ÿğ‘œğ‘š ğ‘ğ‘‘ğ‘šğ‘–ğ‘› ğ‘ğ‘œğ‘¡ ğ‘¡ğ‘œ ğ‘ğ‘™ğ‘™ ğ‘â„ğ‘ğ‘¡ ğ‘”ğ‘Ÿğ‘œğ‘¢ğ‘ğ‘  (ğ‘‘ğ‘œ ğ‘›ğ‘œğ‘¡ ğ‘Ÿğ‘’ğ‘ğ‘™ğ‘¦ ğ‘¡ğ‘œ ğ‘¡â„ğ‘–ğ‘  ğ‘šğ‘’ğ‘ ğ‘ ğ‘ğ‘”ğ‘’)\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nğ»ğ‘’ğ‘™ğ‘™ğ‘œ\n\n";
        
        let body = notificationHeader + 
                  "â”Œâ”€â”â”â”â”â”â•â”â•â”â”â”â”â”â•â”â•â”â”â”â”â”â”€â”\n" +
                  "   âš¡ ğŸ’® ğ‘‡ğ‘…Ã˜ğ‘ ğ´ğ‘…Ã‹ğ‘† ğµÃ˜ğ‘‡ ğ¶ğ‘Œğµğ¸ğ‘…ğ‘ğ¸ğ‘‡ğ¼ğ¶ ğ¼ğ‘ğ‘‡ğ¸ğ‘…ğ¹ğ´ğ¶ğ¸ âš¡\n" +
                  "â””â”€â”â”â”â”â”â•â”â•â”â”â”â”â”â•â”â•â”â”â”â”â”â”€â”˜\n\n";
        
        const categories = {};
        const categoryEmojis = {
          'admin': 'ğŸ”§', 'ai': 'ğŸ¤–', 'ai-generated': 'ğŸŒ€', 'ai-image': 'ğŸ¨',
          'box chat': 'ğŸ’¬', 'config': 'âš™ï¸', 'contacts admin': 'ğŸ“',
          'custom': 'ğŸ› ï¸', 'demo': 'ğŸ“‚', 'economy': 'ğŸ’', 'fun': 'ğŸ‰',
          'game': 'ğŸ®', 'image': 'ğŸŒŒ', 'info': 'ğŸ“Œ', 'market': 'ğŸª',
          'media': 'ğŸ“¥', 'music': 'ğŸµ', 'nsfw': 'ğŸ”', 'other': 'ğŸŒ',
          'owner': 'ğŸ‘‘', 'premium': 'ğŸŒŸ', 'rank': 'ğŸ†', 'software': 'ğŸ“±',
          'system': 'ğŸ–¥ï¸', 'tools': 'ğŸ”§', 'tts': 'ğŸ—£ï¸', 'uploader': 'ğŸ“¤',
          'utility': 'ğŸ§°', 'wiki': 'ğŸ“–', 'xudlingpong': 'âš¡'
        };

        for(let [name, cmd] of commands) {
          const cat = cmd.config.category?.toLowerCase() || "other";
          if(!categories[cat]) categories[cat] = [];
          categories[cat].push(name);
        }

        // Afficher les catÃ©gories principales dans un style cyberpunk
        const sortedCats = Object.keys(categories).sort();
        for(const cat of sortedCats) {
          const emoji = categoryEmojis[cat] || 'â—ˆ';
          const catName = cat.toUpperCase().replace('-', ' ');
          
          body += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“\n`;
          body += `â”ƒ  ${emoji} ${toAZStyle(catName)}\n`;
          body += `â”£â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”«\n`;
          
          const sortedCommands = categories[cat].sort();
          // Organiser en colonnes (3 colonnes max)
          const maxPerColumn = Math.ceil(sortedCommands.length / 3);
          const columns = [];
          
          for(let i = 0; i < 3; i++) {
            columns.push(sortedCommands.slice(i * maxPerColumn, (i + 1) * maxPerColumn));
          }
          
          const maxRows = Math.max(...columns.map(col => col.length));
          for(let row = 0; row < maxRows; row++) {
            let rowText = "â”ƒ ";
            for(let col = 0; col < columns.length; col++) {
              if(columns[col][row]) {
                rowText += `â—ˆ ${toAZStyle(columns[col][row])}`;
                if(col < columns.length - 1) rowText += "    ";
              }
            }
            body += `${rowText}\n`;
          }
          body += `â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›\n\n`;
        }

        // Footer avec statistiques
        body += "â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬\n" +
                "   ğŸ“Š ğ‘†ğ‘Œğ‘†ğ‘‡ğ¸ğ‘€ ğ‘†ğ‘‡ğ´ğ‘‡ğ‘ˆğ‘†\n" +
                "â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬\n" +
                "â”‚ â—ˆ ğ‘‡ğ‘œğ‘¡ğ‘ğ‘™ ğ¶ğ‘œğ‘šğ‘šğ‘ğ‘›ğ‘‘ğ‘ : " + commands.size + "\n" +
                "â”‚ â—ˆ ğ¶ğ‘ğ‘¡ğ‘’ğ‘”ğ‘œğ‘Ÿğ‘–ğ‘’ğ‘ : " + sortedCats.length + "\n" +
                "â”‚ â—ˆ ğ‘†ğ‘¦ğ‘ ğ‘¡ğ‘’ğ‘š ğ‘†ğ‘¡ğ‘ğ‘¡ğ‘¢ğ‘ : ğ‘‚ğ‘ğ‘’ğ‘Ÿğ‘ğ‘¡ğ‘–ğ‘œğ‘›ğ‘ğ‘™\n" +
                "â•°â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n" +
                "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n" +
                "â”‚  ğŸ¯ ğ‘„ğ‘ˆğ¼ğ¶ğ¾ ğ‘…ğ¸ğ¹ğ¸ğ‘…ğ¸ğ‘ğ¶ğ¸      â”‚\n" +
                "â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\n" +
                "â”‚   â—ˆ .help <command>     â”‚\n" +
                "â”‚   â—ˆ .help -ai <keyword> â”‚\n" +
                "â”‚   â—ˆ .help -s <search>   â”‚\n" +
                "â”‚   â—ˆ .callad [message]   â”‚\n" +
                "â”‚                           â”‚\n" +
                "â”‚   ğŸ’® ğ‘‡ğ‘…Ã˜ğ‘ ğ´ğ‘…Ã‹ğ‘† ğµÃ˜ğ‘‡      â”‚\n" +
                "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜";

        const res = await message.reply({ body, attachment: await global.utils.getStreamFromURL(avatar)});
        return autoDelete(res.messageID);
      }

      // --- Command Info ---
      const query = args[0].toLowerCase();
      const command = commands.get(query) || commands.get(aliases.get(query));
      if(!command) {
        const res = await message.reply({ 
          body: "ğŸ“¢ ğ‘ğ‘œğ‘¡ğ‘–ğ‘“ğ‘–ğ‘ğ‘ğ‘¡ğ‘–ğ‘œğ‘› ğ‘“ğ‘Ÿğ‘œğ‘š ğ‘ğ‘‘ğ‘šğ‘–ğ‘› ğ‘ğ‘œğ‘¡ ğ‘¡ğ‘œ ğ‘ğ‘™ğ‘™ ğ‘â„ğ‘ğ‘¡ ğ‘”ğ‘Ÿğ‘œğ‘¢ğ‘ğ‘  (ğ‘‘ğ‘œ ğ‘›ğ‘œğ‘¡ ğ‘Ÿğ‘’ğ‘ğ‘™ğ‘¦ ğ‘¡ğ‘œ ğ‘¡â„ğ‘–ğ‘  ğ‘šğ‘’ğ‘ ğ‘ ğ‘ğ‘”ğ‘’)\n" +
                "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n" +
                "â”Œâ”€â”â”â”â”â”â•â”â•â”â”â”â”â”â”€â”\n" +
                "   âš¡ ğ¶ğ‘‚ğ‘€ğ‘€ğ´ğ‘ğ· ğ´ğ‘ğ´ğ¿ğ‘Œğ‘†ğ¼ğ‘† âš¡\n" +
                "â””â”€â”â”â”â”â”â•â”â•â”â”â”â”â”â”€â”˜\n\n" +
                "â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬\n" +
                "   âŒ ğ¸ğ‘…ğ‘…ğ‘‚ğ‘… ğ‘…ğ¸ğ‘ƒğ‘‚ğ‘…ğ‘‡\n" +
                "â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬\n" +
                "â”‚ ğ¶ğ‘œğ‘šğ‘šğ‘ğ‘›ğ‘‘ '" + query + "' ğ‘›ğ‘œğ‘¡ ğ‘“ğ‘œğ‘¢ğ‘›ğ‘‘\n" +
                "â”‚ ğ‘–ğ‘› ğ‘‘ğ‘ğ‘¡ğ‘ğ‘ğ‘ğ‘ ğ‘’\n" +
                "â•°â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”",
          attachment: await global.utils.getStreamFromURL(avatar)
        });
        return autoDelete(res.messageID);
      }

      const cfg = command.config || {};
      const roleMap = {0:"ğŸŸ¢ ğ¿ğ¸ğ‘‰ğ¸ğ¿ 0 (ğ´ğ‘™ğ‘™ ğ‘ˆğ‘ ğ‘’ğ‘Ÿğ‘ )", 1:"ğŸŸ¡ ğ¿ğ¸ğ‘‰ğ¸ğ¿ 1 (ğºğ‘Ÿğ‘œğ‘¢ğ‘ ğ´ğ‘‘ğ‘šğ‘–ğ‘›ğ‘ )", 2:"ğŸ”´ ğ¿ğ¸ğ‘‰ğ¸ğ¿ 2 (ğµğ‘œğ‘¡ ğ´ğ‘‘ğ‘šğ‘–ğ‘›ğ‘ )"};
      const aliasesList = Array.isArray(cfg.aliases) && cfg.aliases.length ? cfg.aliases.map(a=>toAZStyle(a)).join(" | ") : "ğ‘ğ‘œğ‘›ğ‘’";
      const desc = cfg.longDescription?.en || cfg.shortDescription?.en || "ğ‘ğ‘œ ğ‘‘ğ‘’ğ‘ ğ‘ğ‘Ÿğ‘–ğ‘ğ‘¡ğ‘–ğ‘œğ‘›.";
      const usage = cfg.guide?.en || cfg.name;

      const card = "ğŸ“¢ ğ‘ğ‘œğ‘¡ğ‘–ğ‘“ğ‘–ğ‘ğ‘ğ‘¡ğ‘–ğ‘œğ‘› ğ‘“ğ‘Ÿğ‘œğ‘š ğ‘ğ‘‘ğ‘šğ‘–ğ‘› ğ‘ğ‘œğ‘¡ ğ‘¡ğ‘œ ğ‘ğ‘™ğ‘™ ğ‘â„ğ‘ğ‘¡ ğ‘”ğ‘Ÿğ‘œğ‘¢ğ‘ğ‘  (ğ‘‘ğ‘œ ğ‘›ğ‘œğ‘¡ ğ‘Ÿğ‘’ğ‘ğ‘™ğ‘¦ ğ‘¡ğ‘œ ğ‘¡â„ğ‘–ğ‘  ğ‘šğ‘’ğ‘ ğ‘ ğ‘ğ‘”ğ‘’)\n" +
                  "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n" +
                  "â”Œâ”€â”â”â”â”â”â•â”â•â”â”â”â”â”â”€â”\n" +
                  "   âš¡ ğ¶ğ‘‚ğ‘€ğ‘€ğ´ğ‘ğ· ğ´ğ‘ğ´ğ¿ğ‘Œğ‘†ğ¼ğ‘† âš¡\n" +
                  "â””â”€â”â”â”â”â”â•â”â•â”â”â”â”â”â”€â”˜\n\n" +
                  "â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬\n" +
                  "   ğŸ›°ï¸ ğ‘ƒğ‘…ğ‘‚ğ‘‡ğ‘‚ğ¶ğ‘‚ğ¿ ğ·ğ´ğ‘‡ğ´\n" +
                  "â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬\n\n" +
                  "â—ˆ ğ¼ğ·ğ¸ğ‘ğ‘‡ğ¼ğ¹ğ¼ğ¸ğ‘…: " + toAZStyle(cfg.name) + "\n" +
                  "â—ˆ ğ·ğ¸ğ‘†ğ¶ğ‘…ğ¼ğ‘ƒğ‘‡ğ¼ğ‘‚ğ‘: " + desc + "\n" +
                  "â—ˆ ğ¶ğ´ğ‘‡ğ¸ğºğ‘‚ğ‘…ğ‘Œ: " + (cfg.category || "ğ‘€ğ‘–ğ‘ ğ‘") + "\n" +
                  "â—ˆ ğ´ğ¿ğ¼ğ´ğ‘† ğ‘ƒğ‘…ğ‘‚ğ‘‡ğ‘‚ğ¶ğ‘‚ğ¿ğ‘†: " + aliasesList + "\n" +
                  "â—ˆ ğ‘†ğ¸ğ¶ğ‘ˆğ‘…ğ¼ğ‘‡ğ‘Œ ğ¿ğ¸ğ‘‰ğ¸ğ¿: " + (roleMap[cfg.role] || "ğ‘ˆğ‘›ğ‘˜ğ‘›ğ‘œğ‘¤ğ‘›") + "\n" +
                  "â—ˆ ğ¶ğ‘‚ğ‘‚ğ¿ğ·ğ‘‚ğ‘Šğ‘: " + (cfg.countDown || 1) + "s\n" +
                  "â—ˆ ğ‘‰ğ¸ğ‘…ğ‘†ğ¼ğ‘‚ğ‘: " + (cfg.version || "1.0") + "\n" +
                  "â—ˆ ğ·ğ¸ğ‘‰ğ¸ğ¿ğ‘‚ğ‘ƒğ¸ğ‘…: " + (cfg.author || "ğ‘ˆğ‘›ğ‘˜ğ‘›ğ‘œğ‘¤ğ‘›") + "\n\n" +
                  "â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬\n" +
                  "   ğŸ“– ğ¸ğ‘‹ğ¸ğ¶ğ‘ˆğ‘‡ğ¼ğ‘‚ğ‘ ğ‘†ğ‘Œğ‘ğ‘‡ğ´ğ‘‹\n" +
                  "â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬\n" +
                  "â”‚ ." + toAZStyle(usage) + "\n" +
                  "â•°â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n" +
                  "â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬\n" +
                  "   âš¡ ğ‘‚ğ‘ƒğ‘‡ğ¼ğ‘‚ğ‘ğ‘†\n" +
                  "â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬\n" +
                  "â”‚ â—ˆ .help " + toAZStyle(cfg.name.toLowerCase()) + " -u\n" +
                  "â”‚ â—ˆ .help " + toAZStyle(cfg.name.toLowerCase()) + " -i\n" +
                  "â”‚ â—ˆ .help " + toAZStyle(cfg.name.toLowerCase()) + " -a\n" +
                  "â”‚ â—ˆ .help " + toAZStyle(cfg.name.toLowerCase()) + " -r\n" +
                  "â•°â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”";

      const res = await message.reply({ body: card, attachment: await global.utils.getStreamFromURL(avatar)});
      return autoDelete(res.messageID);

    } catch(err) {
      console.error("ğŸ’® TRÃ˜N ARÃ‹S BÃ˜T HELP ERROR:", err);
      const errorMsg = "ğŸ“¢ ğ‘ğ‘œğ‘¡ğ‘–ğ‘“ğ‘–ğ‘ğ‘ğ‘¡ğ‘–ğ‘œğ‘› ğ‘“ğ‘Ÿğ‘œğ‘š ğ‘ğ‘‘ğ‘šğ‘–ğ‘› ğ‘ğ‘œğ‘¡ ğ‘¡ğ‘œ ğ‘ğ‘™ğ‘™ ğ‘â„ğ‘ğ‘¡ ğ‘”ğ‘Ÿğ‘œğ‘¢ğ‘ğ‘  (ğ‘‘ğ‘œ ğ‘›ğ‘œğ‘¡ ğ‘Ÿğ‘’ğ‘ğ‘™ğ‘¦ ğ‘¡ğ‘œ ğ‘¡â„ğ‘–ğ‘  ğ‘šğ‘’ğ‘ ğ‘ ğ‘ğ‘”ğ‘’)\n" +
                      "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n" +
                      "â”Œâ”€â”â”â”â”â”â•â”â•â”â”â”â”â”â”€â”\n" +
                      "   âš¡ ğ‘†ğ‘Œğ‘†ğ‘‡ğ¸ğ‘€ ğ¸ğ‘…ğ‘…ğ‘‚ğ‘… âš¡\n" +
                      "â””â”€â”â”â”â”â”â•â”â•â”â”â”â”â”â”€â”˜\n\n" +
                      "â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬\n" +
                      "   âŒ ğ¸ğ‘…ğ‘…ğ‘‚ğ‘…\n" +
                      "â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬â–¬\n" +
                      "â”‚ " + (err.message || err) + "\n" +
                      "â•°â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”";
      await message.reply(errorMsg);
    }
  }
};
